# 功能需求文档模板

> 使用此模板编写需求文档，可让 Claude Code 开发效率最大化

---

## 基本信息

| 字段 | 值 |
|------|-----|
| 功能名称 | [简短标题，如：用户邀请系统] |
| 优先级 | P0 / P1 / P2 |
| 预估复杂度 | 简单 / 中等 / 复杂 |
| 关联模块 | [如：用户模块、支付模块] |

---

## 1. 目标 (What & Why)

### 一句话说明
[用一句话描述这个功能要做什么]

### 用户价值
[这个功能解决用户什么痛点？为什么要做？]

### 成功指标
- [指标1：如转化率提升 X%]
- [指标2：如用户操作步骤减少 Y 步]

---

## 2. 范围 (Scope)

### 要做 (In Scope)
- [ ] 功能点1：[具体描述]
- [ ] 功能点2：[具体描述]
- [ ] 功能点3：[具体描述]

### 不做 (Out of Scope)
- [ ] 排除项1：[说明为什么不做]
- [ ] 排除项2：[后续迭代再做]

### 依赖项
- [依赖1：如需要先完成 XXX 功能]
- [依赖2：如需要 XXX API 接入]

---

## 3. 技术规格 (Technical Spec)

### 3.1 涉及文件

```yaml
新建:
  - src/lib/services/xxx-service.ts      # 服务层
  - src/lib/db/models/xxx.ts             # 数据模型
  - src/app/api/xxx/route.ts             # API 路由

修改:
  - src/lib/services/index.ts            # 添加导出
  - src/components/xxx/index.tsx         # UI 组件

参考:
  - src/lib/services/yyy-service.ts      # 可参考此文件的模式
```

### 3.2 数据模型

```typescript
// 输入类型
interface XxxInput {
  userId: string
  // 添加其他字段...
}

// 输出类型
interface XxxOutput {
  success: boolean
  data: {
    id: string
    // 添加其他字段...
  }
  error?: string
}

// 数据库模型 (如果需要)
interface XxxDocument {
  _id: ObjectId
  userId: ObjectId
  createdAt: Date
  updatedAt: Date
  // 添加其他字段...
}
```

### 3.3 API 设计

```yaml
端点: POST /api/xxx
认证: 需要登录 (NextAuth)
请求体: XxxInput
响应体: XxxOutput

示例请求:
  {
    "userId": "user_123"
  }

示例响应 (成功):
  {
    "success": true,
    "data": {
      "id": "xxx_456"
    }
  }

示例响应 (失败):
  {
    "success": false,
    "error": "用户不存在"
  }
```

### 3.4 业务逻辑

```
流程图/伪代码:

1. 验证输入参数
   - 检查 userId 是否存在
   - 检查用户权限

2. 执行业务逻辑
   - 步骤 A
   - 步骤 B

3. 返回结果
   - 成功：返回数据
   - 失败：返回错误信息
```

---

## 4. 边界情况 & 错误处理

| 场景 | 预期行为 | 错误码/提示 |
|------|---------|-------------|
| 用户未登录 | 跳转登录页 | 401 Unauthorized |
| 参数缺失 | 返回错误 | 400 "缺少必填参数" |
| 资源不存在 | 返回错误 | 404 "资源不存在" |
| 无权限操作 | 返回错误 | 403 "无权限执行此操作" |
| 服务器错误 | 记录日志，返回友好提示 | 500 "系统繁忙，请稍后重试" |

---

## 5. UI/交互设计 (如适用)

### 页面位置
[描述功能入口在哪里，如：设置页面 -> 邀请管理]

### 交互流程
1. 用户点击 [按钮名称]
2. 弹出 [弹窗/跳转页面]
3. 用户填写 [表单内容]
4. 点击确认后 [执行动作]
5. 显示 [成功/失败提示]

### 设计稿
[链接或截图，如果有的话]

---

## 6. 验收标准 (Definition of Done)

### 功能验收
- [ ] 正常流程可以走通
- [ ] 所有边界情况都有处理
- [ ] 错误提示友好清晰

### 代码质量
- [ ] 遵循项目代码规范 (CLAUDE.md)
- [ ] TypeScript 类型完整，无 any
- [ ] 关键逻辑有注释

### 测试
- [ ] 通过现有单元测试
- [ ] 手动测试通过

---

## 7. 参考资料

### 类似实现
- `src/lib/services/xxx.ts` - 可参考此服务的实现模式
- [外部链接] - 相关技术文档

### 相关文档
- [PRD 链接]
- [设计稿链接]
- [API 文档链接]

---

## 8. 开发备注 (可选)

### 技术建议
[对实现方式的建议，如：建议使用 Redis 缓存]

### 潜在风险
[可能遇到的问题，如：高并发下可能有性能问题]

### 后续优化
[当前版本不做，但后续可以优化的点]

---

## 变更记录

| 日期 | 版本 | 变更内容 | 作者 |
|------|------|----------|------|
| YYYY-MM-DD | v1.0 | 初始版本 | [姓名] |
