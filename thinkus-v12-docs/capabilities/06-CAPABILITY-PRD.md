# Thinkus 能力系统 - 产品需求文档

> **版本**: v12.0 | **日期**: 2026-01-15
>
> **能力分类**: Skills (技能) + Subagents (子代理) + MCP (协议)

---

## 一、能力系统概述

```yaml
定义:
  能力系统是Thinkus的扩展机制，让AI员工能够:
  1. 使用预定义的技能 (Skills)
  2. 启动专门的子代理执行复杂任务 (Subagents)
  3. 连接外部服务和工具 (MCP)

价值:
  • 扩展性: 不修改核心代码即可增加新能力
  • 专业性: 每个能力专注一个领域
  • 可组合: 多个能力可以组合使用
```

### 1.1 三层能力架构

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                                                                              │
│                          Thinkus 能力系统                                   │
│                                                                              │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │                     Layer 1: Skills (技能)                           │   │
│  │                                                                      │   │
│  │  轻量级、单次调用、无状态                                           │   │
│  │  ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────────┐              │   │
│  │  │ 代码分析 │ │ 文档生成 │ │ 数据提取 │ │ 格式转换 │              │   │
│  │  └──────────┘ └──────────┘ └──────────┘ └──────────┘              │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                                                              │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │                   Layer 2: Subagents (子代理)                        │   │
│  │                                                                      │   │
│  │  重量级、多步骤、有状态                                             │   │
│  │  ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────────┐              │   │
│  │  │ 前端开发 │ │ 后端开发 │ │ 测试执行 │ │ 部署运维 │              │   │
│  │  └──────────┘ └──────────┘ └──────────┘ └──────────┘              │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                                                              │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │                      Layer 3: MCP (外部服务)                         │   │
│  │                                                                      │   │
│  │  标准协议、外部集成、可扩展                                         │   │
│  │  ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────────┐              │   │
│  │  │ context7 │ │ grep_app │ │ browser  │ │ database │              │   │
│  │  │ 官方文档 │ │ GitHub   │ │ 浏览器   │ │ 数据库   │              │   │
│  │  └──────────┘ └──────────┘ └──────────┘ └──────────┘              │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 二、Skills (技能)

### 2.1 技能特点

```yaml
特点:
  - 轻量级: 单次调用即可完成
  - 无状态: 不需要记住之前的调用
  - 快速: 响应时间通常<5秒
  - 专注: 每个技能只做一件事

使用场景:
  - 代码片段分析
  - 文档格式转换
  - 数据提取和处理
  - 快速查询
```

### 2.2 内置技能列表

| 技能 | 描述 | 输入 | 输出 |
|------|------|------|------|
| `analyze_code` | 分析代码质量和问题 | 代码文本 | 分析报告 |
| `generate_doc` | 生成代码文档 | 代码文本 | Markdown文档 |
| `extract_data` | 从文本提取结构化数据 | 文本 | JSON |
| `convert_format` | 格式转换(JSON/YAML/XML) | 文本 | 转换后文本 |
| `explain_error` | 解释错误信息 | 错误日志 | 解释和建议 |
| `suggest_fix` | 建议代码修复 | 代码+错误 | 修复建议 |

---

## 三、Subagents (子代理)

### 3.1 子代理特点

```yaml
特点:
  - 重量级: 执行多步骤任务
  - 有状态: 记住执行上下文
  - 自主: 可以自己决定下一步
  - 专业: 专注特定领域的复杂任务

使用场景:
  - 完整功能开发
  - 端到端测试
  - 系统部署
  - 大规模重构
```

### 3.2 内置子代理

#### Frontend Developer

```yaml
ID: frontend_dev
描述: 前端开发子代理

能力:
  - React/Vue/Next.js开发
  - 组件设计和实现
  - 样式和动画
  - 响应式布局

触发条件:
  - 需要创建前端页面
  - 需要实现UI组件
  - 前端Bug修复
```

#### Backend Developer

```yaml
ID: backend_dev
描述: 后端开发子代理

能力:
  - API设计和实现
  - 数据库设计
  - 业务逻辑实现
  - 性能优化

触发条件:
  - 需要创建API
  - 数据库相关任务
  - 后端Bug修复
```

#### Test Runner

```yaml
ID: test_runner
描述: 测试执行子代理

能力:
  - 测试用例生成
  - 自动化测试执行
  - 测试报告生成
  - 覆盖率分析

触发条件:
  - 需要运行测试
  - 测试用例设计
  - 质量验证
```

---

## 四、MCP (Model Context Protocol)

### 4.1 MCP特点

```yaml
特点:
  - 标准化: 统一的调用协议
  - 可扩展: 可以添加新的MCP服务
  - 外部集成: 连接外部工具和服务

支持的MCP服务:
  - context7: 官方文档查询
  - grep_app: GitHub代码搜索
  - browser: 浏览器操作
  - database: 数据库操作
  - filesystem: 文件系统操作
```

### 4.2 context7 (官方文档)

```yaml
描述: 查询主流框架的官方文档

支持的框架:
  - Next.js
  - React
  - Vue
  - Node.js
  - TypeScript
  - TailwindCSS
  - PostgreSQL
  - MongoDB

使用方式:
  Librarian: "让我查一下Next.js 14的App Router文档..."
  → 调用context7 → 返回官方文档内容
```

### 4.3 grep_app (GitHub搜索)

```yaml
描述: 在GitHub上搜索代码示例

功能:
  - 按关键词搜索
  - 按语言过滤
  - 按星数排序
  - 获取代码片段

使用方式:
  Librarian: "找一下React实现虚拟滚动的开源代码..."
  → 调用grep_app → 返回相关仓库和代码
```

### 4.4 browser (浏览器操作)

```yaml
描述: 控制浏览器执行操作

功能:
  - 页面导航
  - 元素操作
  - 截图
  - 数据提取

使用方式:
  用于视觉验证和端到端测试
```

---

## 五、能力调用流程

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                                                                              │
│                         能力调用流程                                        │
│                                                                              │
│  用户消息                                                                    │
│      │                                                                       │
│      ▼                                                                       │
│  ┌──────────────────────────────────────────────────────────────────────┐  │
│  │ 1. AI员工分析任务                                                    │  │
│  │    "用户需要查官方文档 → 需要调用MCP context7"                      │  │
│  │    "用户需要开发前端 → 需要启动Subagent frontend_dev"               │  │
│  └──────────────────────────────────────────────────────────────────────┘  │
│      │                                                                       │
│      ▼                                                                       │
│  ┌──────────────────────────────────────────────────────────────────────┐  │
│  │ 2. 选择合适的能力                                                    │  │
│  │                                                                       │  │
│  │    轻量任务 → Skill (直接调用)                                       │  │
│  │    复杂任务 → Subagent (启动子代理)                                  │  │
│  │    外部查询 → MCP (调用外部服务)                                     │  │
│  └──────────────────────────────────────────────────────────────────────┘  │
│      │                                                                       │
│      ▼                                                                       │
│  ┌──────────────────────────────────────────────────────────────────────┐  │
│  │ 3. 执行能力                                                          │  │
│  │                                                                       │  │
│  │    Skill: 单次调用 → 返回结果                                        │  │
│  │    Subagent: 多步执行 → 实时报告 → 最终结果                         │  │
│  │    MCP: 协议调用 → 解析响应 → 返回结果                              │  │
│  └──────────────────────────────────────────────────────────────────────┘  │
│      │                                                                       │
│      ▼                                                                       │
│  ┌──────────────────────────────────────────────────────────────────────┐  │
│  │ 4. 整合结果                                                          │  │
│  │    AI员工将能力返回的结果整合为用户可理解的回复                     │  │
│  └──────────────────────────────────────────────────────────────────────┘  │
│      │                                                                       │
│      ▼                                                                       │
│   返回给用户                                                                 │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 六、成功指标

| 指标 | 目标值 |
|------|--------|
| Skill调用成功率 | >99% |
| Subagent任务完成率 | >95% |
| MCP服务可用性 | >99.5% |
| 能力选择准确率 | >90% |
| 平均Skill响应时间 | <3秒 |
| 平均Subagent完成时间 | <5分钟 |

---

## 七、开发优先级

### P0 (2周)

| 功能 | 工作量 |
|------|--------|
| Skills框架和核心技能 | 4天 |
| Subagents框架 | 4天 |
| MCP客户端基础 | 3天 |

### P1 (2周)

| 功能 | 工作量 |
|------|--------|
| context7集成 | 2天 |
| grep_app集成 | 2天 |
| browser MCP | 3天 |
| 更多Skills | 3天 |
